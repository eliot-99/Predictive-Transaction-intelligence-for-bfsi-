{% extends "base.html" %}

{% block title %}Fraud Prediction - FraudGuard BFSI{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Page Header -->
    <div class="page-header mb-5">
        <div class="row align-items-center">
            <div class="col">
                <h1 class="display-4 fw-bold text-white mb-2 header-title">
                    <i class="fas fa-microscope me-3 text-white"></i>Fraud Risk Assessment
                </h1>
                <p class="page-description text-white fs-5 header-subtitle">
                    <i class="fas fa-info-circle me-2 text-white"></i>Enter transaction details for real-time fraud detection analysis
                </p>
            </div>
            <div class="col-auto">
                <div class="card bg-white border-0 shadow-sm p-3 protected-badge">
                    <div class="text-center">
                        <i class="fas fa-shield-alt text-primary" style="font-size: 2.5rem;"></i>
                        <p class="mb-0 small text-dark mt-2 fw-bold">Protected Detection</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Form Container -->
    <div id="formContainer" class="form-container-wrapper{% if show_result %} d-none{% endif %}">
        <div class="row g-4">
            <!-- Prediction Form -->
            <div class="col-12">
            <div class="card border-0 shadow-md rounded-3 animate__animated animate__fadeInLeft">
                <!-- Form Header -->
                <div class="card-header bg-gradient-primary text-white py-4 rounded-top-3 border-0">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <h4 class="mb-0 fw-bold">
                                <i class="fas fa-file-invoice me-2"></i>Transaction Analysis Form
                            </h4>
                            <small class="mt-2 d-block opacity-75">All 25 fields are required for accurate prediction</small>
                        </div>
                        <div class="badge bg-light text-primary fs-6 px-3 py-2">
                            <i class="fas fa-list me-1"></i>25 Fields
                        </div>
                    </div>
                </div>

                <!-- Form Body -->
                <div class="card-body p-4">
                    <form method="POST" id="predictionForm">
                        <!-- Section 1: Basic Information -->
                        <div class="form-section mb-5">
                            <div class="section-header mb-4">
                                <div class="d-flex align-items-center gap-2">
                                    <div class="section-icon bg-primary-light">
                                        <i class="fas fa-user-circle text-primary"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0 fw-bold text-dark">Basic Information</h5>
                                        <small class="text-muted">User and account details</small>
                                    </div>
                                </div>
                                <hr class="mt-3 mb-0">
                            </div>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">User ID</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-hashtag text-primary"></i></span>
                                        <input type="number" class="form-control form-control-professional" name="User_ID" value="1" required>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Transaction Amount</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-coins text-success"></i></span>
                                        <input type="number" step="0.01" class="form-control form-control-professional" name="Transaction_Amount" value="1000000" placeholder="Amount in UZS" required>
                                    </div>
                                    <small class="text-muted d-block mt-2">Currency: UZS (Uzbekistan Som)</small>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Location</label>
                                    <select class="form-select form-select-professional" name="Transaction_Location" required>
                                        <option value="">-- Select Location --</option>
                                        <option value="Tashkent">üá∫üáø Tashkent</option>
                                        <option value="Samarkand">üá∫üáø Samarkand</option>
                                        <option value="Bukhara">üá∫üáø Bukhara</option>
                                        <option value="Moscow">üá∑üá∫ Moscow</option>
                                        <option value="Dubai">üá¶üá™ Dubai</option>
                                        <option value="Russia">üá∑üá∫ Russia</option>
                                        <option value="Turkey">üáπüá∑ Turkey</option>
                                        <option value="USA">üá∫üá∏ USA</option>
                                        <option value="China">üá®üá≥ China</option>
                                        <option value="UAE">üá¶üá™ UAE</option>
                                    </select>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Merchant ID</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-store text-warning"></i></span>
                                        <input type="number" class="form-control form-control-professional" name="Merchant_ID" value="1" required>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Device ID</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-mobile-alt text-info"></i></span>
                                        <input type="number" class="form-control form-control-professional" name="Device_ID" value="1" required>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Card Type</label>
                                    <select class="form-select form-select-professional" name="Card_Type" required>
                                        <option value="">-- Select Card Type --</option>
                                        <option value="Credit">üí≥ Credit Card</option>
                                        <option value="Debit">üè¶ Debit Card</option>
                                        <option value="Prepaid">üì± Prepaid Card</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Section 2: Transaction Details -->
                        <div class="form-section mb-5">
                            <div class="section-header mb-4">
                                <div class="d-flex align-items-center gap-2">
                                    <div class="section-icon bg-success-light">
                                        <i class="fas fa-exchange-alt text-success"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0 fw-bold text-dark">Transaction Details</h5>
                                        <small class="text-muted">Transaction specifics and status</small>
                                    </div>
                                </div>
                                <hr class="mt-3 mb-0">
                            </div>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Currency</label>
                                    <select class="form-select form-select-professional" name="Transaction_Currency" required>
                                        <option value="">-- Select Currency --</option>
                                        <option value="UZS">üá∫üáø UZS (Uzbek Som)</option>
                                        <option value="USD">üá∫üá∏ USD (US Dollar)</option>
                                        <option value="EUR">üá™üá∫ EUR (Euro)</option>
                                        <option value="RUB">üá∑üá∫ RUB (Russian Ruble)</option>
                                        <option value="AED">üá¶üá™ AED (UAE Dirham)</option>
                                    </select>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Transaction Status</label>
                                    <select class="form-select form-select-professional" name="Transaction_Status" required>
                                        <option value="">-- Select Status --</option>
                                        <option value="Completed">‚úì Completed</option>
                                        <option value="Pending">‚è≥ Pending</option>
                                        <option value="Declined">‚úó Declined</option>
                                    </select>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Previous Transaction Count</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-history text-secondary"></i></span>
                                        <input type="number" class="form-control form-control-professional" name="Previous_Transaction_Count" value="5" required>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Distance Between Transactions</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-map-marker-alt text-danger"></i></span>
                                        <input type="number" step="0.01" class="form-control form-control-professional" name="Distance_Between_Transactions_km" value="0" placeholder="km">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Time Since Last Transaction</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-clock text-warning"></i></span>
                                        <input type="number" class="form-control form-control-professional" name="Time_Since_Last_Transaction_min" value="60" placeholder="minutes">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Authentication Method</label>
                                    <select class="form-select form-select-professional" name="Authentication_Method" required>
                                        <option value="">-- Select Method --</option>
                                        <option value="PIN">üîê PIN</option>
                                        <option value="OTP">üìß OTP</option>
                                        <option value="Biometric">üëÜ Biometric</option>
                                        <option value="Password">üîë Password</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Section 3: Behavioral Indicators -->
                        <div class="form-section mb-5">
                            <div class="section-header mb-4">
                                <div class="d-flex align-items-center gap-2">
                                    <div class="section-icon bg-warning-light">
                                        <i class="fas fa-chart-line text-warning"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0 fw-bold text-dark">Behavioral Indicators</h5>
                                        <small class="text-muted">Pattern and velocity analysis</small>
                                    </div>
                                </div>
                                <hr class="mt-3 mb-0">
                            </div>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Transaction Velocity</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-tachometer-alt text-primary"></i></span>
                                        <input type="number" class="form-control form-control-professional" name="Transaction_Velocity" value="1" placeholder="per hour">
                                    </div>
                                    <small class="text-muted d-block mt-2">Transactions in last hour</small>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Transaction Category</label>
                                    <select class="form-select form-select-professional" name="Transaction_Category" required>
                                        <option value="">-- Select Category --</option>
                                        <option value="Shopping">üõçÔ∏è Shopping</option>
                                        <option value="Dining">üçΩÔ∏è Dining</option>
                                        <option value="Travel">‚úàÔ∏è Travel</option>
                                        <option value="Entertainment">üé≠ Entertainment</option>
                                        <option value="Bills">üìã Bills</option>
                                        <option value="Transfer">üí∏ Transfer</option>
                                        <option value="Withdrawal">üí∞ Withdrawal</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Section 4: Temporal Features -->
                        <div class="form-section mb-5">
                            <div class="section-header mb-4">
                                <div class="d-flex align-items-center gap-2">
                                    <div class="section-icon bg-info-light">
                                        <i class="fas fa-calendar-alt text-info"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0 fw-bold text-dark">Temporal Features</h5>
                                        <small class="text-muted">Date and time analysis</small>
                                    </div>
                                </div>
                                <hr class="mt-3 mb-0">
                            </div>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Transaction Hour</label>
                                    <div class="time-slider-container">
                                        <input type="range" class="form-range form-range-professional" name="Transaction_Hour" min="0" max="23" value="12" id="hourSlider">
                                        <div class="time-display d-flex justify-content-between align-items-center mt-2">
                                            <small class="text-muted">Hour:</small>
                                            <span class="badge bg-primary px-3 py-2">
                                                <span id="hourValue">12</span>:00
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Day of Month</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-calendar text-primary"></i></span>
                                        <input type="number" class="form-control form-control-professional" name="Transaction_Day" min="1" max="31" value="15">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Month</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-calendar-check text-success"></i></span>
                                        <input type="number" class="form-control form-control-professional" name="Transaction_Month" min="1" max="12" value="6">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Weekday</label>
                                    <select class="form-select form-select-professional" name="Transaction_Weekday" required>
                                        <option value="">-- Select Day --</option>
                                        <option value="0">üìÖ Monday</option>
                                        <option value="1">üìÖ Tuesday</option>
                                        <option value="2" selected>üìÖ Wednesday</option>
                                        <option value="3">üìÖ Thursday</option>
                                        <option value="4">üìÖ Friday</option>
                                        <option value="5">üìÖ Saturday</option>
                                        <option value="6">üìÖ Sunday</option>
                                    </select>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label fw-600 text-dark">Log Amount</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-calculator text-secondary"></i></span>
                                        <input type="number" step="0.01" class="form-control form-control-professional" name="Log_Transaction_Amount" value="0" readonly>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label fw-600 text-dark">Hour Sin</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-function text-danger"></i></span>
                                        <input type="number" step="0.01" class="form-control form-control-professional" name="Hour_sin" value="0" readonly>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label fw-600 text-dark">Hour Cos</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-function text-info"></i></span>
                                        <input type="number" step="0.01" class="form-control form-control-professional" name="Hour_cos" value="1" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Section 5: Advanced Features -->
                        <div class="form-section mb-5">
                            <div class="section-header mb-4">
                                <div class="d-flex align-items-center gap-2">
                                    <div class="section-icon bg-danger-light">
                                        <i class="fas fa-cog text-danger"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0 fw-bold text-dark">Advanced Features</h5>
                                        <small class="text-muted">Interaction and temporal calculations</small>
                                    </div>
                                </div>
                                <hr class="mt-3 mb-0">
                            </div>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Weekday Sin</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-wave-square text-success"></i></span>
                                        <input type="number" step="0.01" class="form-control form-control-professional" name="Weekday_sin" value="0" readonly>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label fw-600 text-dark">Weekday Cos</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-wave-square text-warning"></i></span>
                                        <input type="number" step="0.01" class="form-control form-control-professional" name="Weekday_cos" value="1" readonly>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label fw-600 text-dark">Velocity √ó Distance</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-times text-secondary"></i></span>
                                        <input type="number" step="0.01" class="form-control form-control-professional" name="Velocity_Distance_Interact" value="0">
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label fw-600 text-dark">Amount √ó Velocity</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-times text-info"></i></span>
                                        <input type="number" step="0.01" class="form-control form-control-professional" name="Amount_Velocity_Interact" value="0">
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label fw-600 text-dark">Time √ó Distance</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-times text-danger"></i></span>
                                        <input type="number" step="0.01" class="form-control form-control-professional" name="Time_Distance_Interact" value="0">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex gap-3 mt-5">
                            <button type="submit" class="btn btn-primary btn-lg fw-bold flex-grow-1 rounded-2 shadow-md">
                                <i class="fas fa-rocket me-2"></i>Analyze for Fraud Risk
                            </button>
                            <button type="reset" class="btn btn-outline-secondary btn-lg fw-bold rounded-2">
                                <i class="fas fa-redo me-2"></i>Reset
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            </div>
        </div>
    </div>

    <!-- Result Container -->
    <div id="resultContainer" class="result-container-wrapper{% if not show_result %} d-none{% endif %}">
        <div class="row g-4">
            <!-- Results Panel -->
            <div class="col-12">
            {% if show_result and result %}
                <!-- Risk Assessment Result Card -->
                <div class="card border-0 shadow-lg rounded-3 overflow-hidden animate__animated animate__fadeInRight">
                    <!-- Result Header with Dynamic Color -->
                    <div class="card-header bg-gradient-{{ risk_class }} text-white py-4 border-0">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <h5 class="mb-0 fw-bold">
                                    <i class="fas fa-{% if risk_class == 'danger' %}exclamation-triangle me-2 animate__animated animate__pulse animate__infinite{% else %}check-circle me-2{% endif %}"></i>Risk Assessment
                                </h5>
                                <small class="mt-2 d-block opacity-75">Analysis Complete</small>
                            </div>
                            <div class="badge bg-white text-{{ risk_class }} fs-6 px-3 py-2 fw-bold">
                                <i class="fas fa-check-circle me-1"></i>RESULT
                            </div>
                        </div>
                    </div>

                    <div class="card-body p-4">
                        <!-- Risk Level Display -->
                        <div class="text-center mb-5 pb-4 border-bottom">
                            <div class="risk-level-display mb-3">
                                <h1 class="display-3 fw-bold text-{{ risk_class }} mb-0">{{ risk_level }}</h1>
                                <p class="text-muted small mt-2 mb-0">Risk Classification</p>
                            </div>
                        </div>

                        <!-- Risk Score Progress Bar -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <small class="fw-bold text-dark">
                                    <i class="fas fa-chart-pie me-1"></i>Overall Risk Score
                                </small>
                                <span class="badge bg-{{ risk_class }} text-white px-3 py-2">
                                    {{ "{:.1%}".format(result.Final_Risk_Score) }}
                                </span>
                            </div>
                            <div class="progress rounded-pill" style="height: 10px;">
                                <div class="progress-bar bg-{{ risk_class }} rounded-pill" role="progressbar" 
                                     style="width: {{ result.Final_Risk_Score * 100 }}%;" 
                                     aria-valuenow="{{ result.Final_Risk_Score * 100 }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>

                        <!-- Fraud Probability Progress Bar -->
                        <div class="mb-5">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <small class="fw-bold text-dark">
                                    <i class="fas fa-percent me-1"></i>Fraud Probability
                                </small>
                                <span class="badge bg-warning text-dark px-3 py-2">
                                    {{ "{:.1%}".format(result.Fraud_Probability) }}
                                </span>
                            </div>
                            <div class="progress rounded-pill" style="height: 10px;">
                                <div class="progress-bar bg-warning rounded-pill" role="progressbar" 
                                     style="width: {{ result.Fraud_Probability * 100 }}%;" 
                                     aria-valuenow="{{ result.Fraud_Probability * 100 }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>

                        <!-- Alert Status -->
                        <div class="alert alert-{{ risk_class }} mb-4 border-0 rounded-2" role="alert">
                            <div class="d-flex align-items-center">
                                {% if result.alert_triggered %}
                                    <i class="fas fa-bell fa-2x me-3 text-warning"></i>
                                    <div>
                                        <h6 class="mb-1 fw-bold">‚ö†Ô∏è ALERT TRIGGERED</h6>
                                        <small>High fraud risk detected - Review before approval</small>
                                    </div>
                                {% else %}
                                    <i class="fas fa-check-circle fa-2x me-3 text-success"></i>
                                    <div>
                                        <h6 class="mb-1 fw-bold">‚úì TRANSACTION SAFE</h6>
                                        <small>Low fraud risk - Transaction approved</small>
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Risk Factors -->
                        {% if result.alert_reasons %}
                            <div class="mb-5">
                                <h6 class="fw-bold mb-3 text-dark d-flex align-items-center">
                                    <span class="risk-factors-badge me-2">
                                        <i class="fas fa-exclamation-circle"></i>
                                    </span>
                                    Risk Factors Detected
                                </h6>
                                <ul class="risk-factors-list">
                                    {% for reason in result.alert_reasons %}
                                        <li class="risk-factor-item">{{ reason }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% else %}
                            <div class="alert alert-success border-0 rounded-2 mb-4" role="alert">
                                <i class="fas fa-shield-alt me-2"></i><strong>No risk factors detected</strong> - Transaction profile is clean
                            </div>
                        {% endif %}

                        <!-- Transaction ID -->
                        <div class="bg-light p-3 rounded-2 mb-4 border-start border-info border-4">
                            <small class="d-block text-muted mb-1 fw-bold">
                                <i class="fas fa-key me-1"></i>Transaction ID
                            </small>
                            <code class="text-monospace text-dark">{{ result.Transaction_ID }}</code>
                        </div>

                        <!-- Analysis Timestamp -->
                        <div class="text-center text-muted small mb-3">
                            <i class="fas fa-clock me-1"></i>Analysis completed at {{ "{:%Y-%m-%d %H:%M:%S}".format(now) }}
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex gap-3 justify-content-center flex-wrap">
                            <a href="{{ url_for('history') }}" class="btn btn-primary fw-bold rounded-2 px-4 py-2">
                                <i class="fas fa-history me-2"></i>View Transaction History
                            </a>
                            <button type="button" class="btn btn-outline-secondary fw-bold rounded-2 px-4 py-2" onclick="toggleToForm();">
                                <i class="fas fa-arrow-left me-2"></i>New Prediction
                            </button>
                        </div>
                    </div>
                </div>
            {% else %}
                <!-- Empty State Card -->
                <div class="card border-0 shadow-sm rounded-3 bg-gradient-light animate__animated animate__fadeInRight">
                    <div class="card-body text-center py-5">
                        <div class="mb-4">
                            <i class="fas fa-tasks text-muted" style="font-size: 4rem; opacity: 0.3;"></i>
                        </div>
                        <h5 class="fw-bold text-dark mb-2">Ready to Analyze</h5>
                        <p class="text-muted mb-0">
                            <i class="fas fa-info-circle me-1"></i>Fill in the transaction details on the left and click "Analyze for Fraud Risk" to see results here.
                        </p>
                        <div class="mt-4 pt-3 border-top">
                            <small class="text-muted d-block">
                                <strong>‚ÑπÔ∏è Tip:</strong> All fields are required for accurate fraud detection analysis. The AI model evaluates 25 features to determine risk level.
                            </small>
                        </div>
                    </div>
                </div>
            {% endif %}
            </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Toggle Visibility Functions
    function toggleToResult() {
        const formContainer = document.getElementById('formContainer');
        const resultContainer = document.getElementById('resultContainer');
        
        formContainer.classList.add('d-none');
        resultContainer.classList.remove('d-none');
        
        // Scroll to top smoothly
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function toggleToForm() {
        const formContainer = document.getElementById('formContainer');
        const resultContainer = document.getElementById('resultContainer');
        
        resultContainer.classList.add('d-none');
        formContainer.classList.remove('d-none');
        
        // Reset form
        document.getElementById('predictionForm').reset();
        
        // Trigger initial calculation
        document.getElementById('predictionForm').dispatchEvent(new Event('change'));
        
        // Scroll to top smoothly
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    // Check if result exists on page load and show it if present
    document.addEventListener('DOMContentLoaded', function() {
        const resultContainer = document.getElementById('resultContainer');
        const hasResult = resultContainer && !resultContainer.classList.contains('d-none');
        
        if (hasResult) {
            // Result is already visible, form should be hidden
            document.getElementById('formContainer').classList.add('d-none');
        }
    });

    // Update hour display
    document.querySelector('[name="Transaction_Hour"]').addEventListener('change', function() {
        document.getElementById('hourValue').textContent = this.value;
    });

    // Auto-calculate sin/cos values
    document.getElementById('predictionForm').addEventListener('change', function() {
        // Calculate Hour sin/cos
        const hour = parseFloat(document.querySelector('[name="Transaction_Hour"]').value) || 0;
        const hourRad = (hour / 24) * 2 * Math.PI;
        document.querySelector('[name="Hour_sin"]').value = Math.sin(hourRad).toFixed(2);
        document.querySelector('[name="Hour_cos"]').value = Math.cos(hourRad).toFixed(2);

        // Calculate Weekday sin/cos
        const weekday = parseFloat(document.querySelector('[name="Transaction_Weekday"]').value) || 0;
        const weekdayRad = (weekday / 7) * 2 * Math.PI;
        document.querySelector('[name="Weekday_sin"]').value = Math.sin(weekdayRad).toFixed(2);
        document.querySelector('[name="Weekday_cos"]').value = Math.cos(weekdayRad).toFixed(2);

        // Calculate Log Transaction Amount
        const amount = parseFloat(document.querySelector('[name="Transaction_Amount"]').value) || 1;
        document.querySelector('[name="Log_Transaction_Amount"]').value = Math.log(amount).toFixed(2);
    });

    // Intercept form submission to toggle to results
    document.getElementById('predictionForm').addEventListener('submit', function(e) {
        // Allow form submission, but toggle view after response
        setTimeout(function() {
            toggleToResult();
        }, 500);
    });

    // Trigger initial calculation
    document.getElementById('predictionForm').dispatchEvent(new Event('change'));
</script>
{% endblock %}